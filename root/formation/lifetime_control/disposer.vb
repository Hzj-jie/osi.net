
Option Explicit On
Option Infer Off
Option Strict On

'the following code is generated by /osi/root/codegen/precompile/precompile.exe
'with disposer.vbp ----------
'so change disposer.vbp instead of this file



'the following code is generated by /osi/root/codegen/precompile/precompile.exe
'with disposer_imports.vbp ----------
'so change disposer_imports.vbp instead of this file


Imports osi.root.connector
Imports osi.root.lock
'finish disposer_imports.vbp --------

Public Class disposer
    Implements IDisposable

    Private ReadOnly _disposer As Action

    Public Sub New(Optional ByVal disposer As Action = Nothing)
        _disposer = disposer
    End Sub

    Protected Overridable Sub disposer()
        assert(Not _disposer Is Nothing)
        _disposer()
    End Sub

    Private Sub do_dispose()
        disposer()
    End Sub


'the following code is generated by /osi/root/codegen/precompile/precompile.exe
'with disposer_core.vbp ----------
'so change disposer_core.vbp instead of this file



    Public Event dispose_exception(ByVal ex As Exception)
    Private exp As singleentry

    Private sub mark_and_dispose()
        If exp.mark_in_use() Then
            Try
                do_dispose()
            Catch ex As Exception
                If event_attached(dispose_exceptionEvent) Then
                    RaiseEvent dispose_exception(ex)
                Else
                    log_unhandled_exception(ex)
                End If
            End Try
        End If
        GC.KeepAlive(Me)
    End Sub

    Public Function disposed() As Boolean
        Return exp.in_use()
    End Function

    Public Sub dispose()
        mark_and_dispose()
#If True Then
        GC.SuppressFinalize(Me)
#End If
    End Sub

    Public Sub queue_dispose()
        queue_in_managed_threadpool(AddressOf mark_and_dispose)
#If True Then
        GC.SuppressFinalize(Me)
#End If
    End Sub

#If True Then

'the following code is generated by /osi/root/codegen/precompile/precompile.exe
'with disposer_dispose.vbp ----------
'so change disposer_dispose.vbp instead of this file


    Public Sub IDisposable_Dispose() Implements IDisposable.Dispose
        dispose()
    End Sub

    Protected NotOverridable Overrides Sub Finalize()
        queue_dispose()
        GC.KeepAlive(Me)
        MyBase.Finalize()
    End Sub
'finish disposer_dispose.vbp --------
#End If
'finish disposer_core.vbp --------
End Class
'finish disposer.vbp --------
