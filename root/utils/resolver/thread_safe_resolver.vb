
Option Explicit On
Option Infer Off
Option Strict On

'the following code is generated by /osi/root/codegen/precompile/precompile.exe
'with thread_safe_resolver.vbp ----------
'so change thread_safe_resolver.vbp instead of this file


'the following code is generated by /osi/root/codegen/precompile/precompile.exe
'with resolver.vbp ----------
'so change resolver.vbp instead of this file



Imports osi.root.connector
Imports osi.root.constants

#If True Then
Imports osi.root.lock
#End If

Public NotInheritable Class thread_safe_resolver(Of T As Class)
#If True Then
    Private l As slimlock.monitorlock
#End If
    Private f As Func(Of T)
    Private cached As T

    Public Sub register(ByVal i As T)
#If True Then
        l.wait()
#End If
        cached = i
#If True Then
        l.release()
#End If
    End Sub

    Public Sub unregister()
        register([default](Of Func(Of T)).null)
    End Sub

    Public Sub register(ByVal i As Func(Of T))
#If True Then
        l.wait()
#End If
        f = i
        cached = Nothing
#If True Then
        l.release()
#End If
    End Sub

    Public Function resolve(ByRef o As T) As Boolean
        If cached Is Nothing Then
#If True Then
            l.wait()
#End If
            Try
                If cached Is Nothing Then
                    If f Is Nothing Then
                        Return False
                    End If
                    cached = f()
                End If
            Finally
#If True Then
                l.release()
#End If
            End Try
        End If
        assert(Not cached Is Nothing)
        o = cached
        Return True
    End Function

    Public Function resolve() As T
        Dim o As T = Nothing
        assert(resolve(o))
        Return o
    End Function

    Public Function resolve_or_null() As T
        Dim o As T = Nothing
        resolve(o)
        Return o
    End Function
End Class
'finish resolver.vbp --------
'finish thread_safe_resolver.vbp --------
