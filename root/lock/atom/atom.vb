
'the following code is generated by /osi/root/codegen/precompile/precompile.exe
'with atom.vbp ----------
'so change atom.vbp instead of this file



'the following code is generated by /osi/root/codegen/precompile/precompile.exe
'with atom_body.vbp ----------
'so change atom_body.vbp instead of this file


Imports System.Threading
Imports osi.root.lock.slimlock
Imports osi.root.delegates
Imports spinlock = osi.root.lock.slimlock.spinlock

Partial Public Class atom(Of T, LOCK_T As {islimlock, Structure})
    Private p As T
    Private l As LOCK_T

    Public Sub New()
    End Sub

    Public Sub New(ByVal i As T)
        [set](i)
    End Sub

    Public Function [get]() As T
        Return atomic.read(p)
    End Function

    Public Sub [set](ByVal i As T)
        atomic.eva(p, i)
    End Sub

    Public Sub modify(ByVal d As void(Of T))
        If Not d Is Nothing Then
            l.locked(Sub() d(p))
        End If
    End Sub

	Public Function exchange(ByVal value As T) As T
	    Return Interlocked.Exchange(p, value)
	End Function

    Public Function compare_exchange(ByVal value As T, ByVal comparand As T) As T
        Return Interlocked.CompareExchange(p, value, comparand)
    End Function

    Public Shared Operator +(ByVal this As atom(Of T, LOCK_T)) As T
        Return If(this Is Nothing, Nothing, this.get())
    End Operator
End Class


Public Class atom(Of T)
    Inherits atom(Of T, spinlock)

    Public Sub New()
        MyBase.New()
    End Sub

    Public Sub New(ByVal i As T)
        MyBase.New(i)
    End Sub
End Class

'finish atom_body.vbp --------
'finish atom.vbp --------
